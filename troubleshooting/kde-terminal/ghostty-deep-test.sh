#!/usr/bin/env bash
set -euo pipefail

echo "[ezdora][ghostty-deep] Teste profundo das teclas Home/End"
echo "==========================================================="
echo ""

echo "üß™ TESTE 1: Captura de teclas brutas"
echo "Execute o comando abaixo e pressione Home, depois End, depois Ctrl+C:"
echo ""
echo "showkey -a"
echo ""
read -r -p "Pressione Enter para continuar ao pr√≥ximo teste..."

echo ""
echo "üß™ TESTE 2: Teste no terminal puro (sem Ghostty)"
echo "Vamos testar no Konsole para compara√ß√£o:"
echo ""
if command -v konsole >/dev/null 2>&1; then
  echo "konsole --hold -e bash -c 'echo Teste Home/End no Konsole: abcdefghijklmnopqrstuvwxyz; bash'"
  echo "Execute o comando acima e teste Home/End"
else
  echo "Konsole n√£o dispon√≠vel"
fi
echo ""
read -r -p "Pressione Enter para continuar ao pr√≥ximo teste..."

echo ""
echo "üß™ TESTE 3: Downgrade do Ghostty"
echo "O KDE tem vers√£o 1.1.3 (tip/dev) e GNOME tem 1.1.2 (stable)"
echo "Pode ser um bug na vers√£o de desenvolvimento."
echo ""
echo "Para testar, voc√™ pode:"
echo "1. Downgrade para vers√£o stable (se dispon√≠vel)"
echo "2. Ou compile a vers√£o 1.1.2"
echo ""

echo "üß™ TESTE 4: Verificar intercepta√ß√£o do KDE"
echo "Execute no terminal do Ghostty:"
echo ""
echo "cat -v"
echo ""
echo "Depois pressione Home/End e veja se aparecem caracteres"
echo "Se n√£o aparecer NADA, o KDE est√° interceptando as teclas"
echo "Se aparecer caracteres estranhos, √© problema de encoding"
echo ""

echo "üîß POSS√çVEIS SOLU√á√ïES:"
echo ""
echo "1. Testar com layout US puro (sem International):"
echo "   setxkbmap us"
echo ""
echo "2. Verificar se √© problema do Wayland:"
echo "   - Logar numa sess√£o X11 do KDE e testar"
echo ""
echo "3. Testar Ghostty com flags diferentes:"
echo "   ghostty --config-file /dev/null"
echo ""
echo "4. Bug report para o Ghostty (vers√£o 1.1.3 tip):"
echo "   https://github.com/ghostty-org/ghostty/issues"